<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    <title>Registration Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            height: 100vh;
            overflow: hidden;
            background: #f0f2f5;
        }

        .sidebar {
            width: 300px;
            min-width: 200px;
            background-image: linear-gradient(rgb(154, 50, 50), rgb(69, 11, 11));
            color: white;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 0;
            overflow-y: auto;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px 10px;
            cursor: pointer;
            transition: background-color 0.3s;
            border-radius: 4px;
            text-decoration: none;
            color: white;
        }

        .menu-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .menu-item.active {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .menu-icon {
            width: 20px;
            height: 20px;
            border: 2px solid white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .main-content {
            flex: 1;
            background-color: #d4d4d4;
            padding: 30px;
            overflow-y: auto;
        }

        .content-wrapper {
            background-color: white;
            border-radius: 8px;
            padding: 30px;
        }

        .page-title {
            color: #7d1414;
            font-size: 24px;
            margin-bottom: 25px;
            font-weight: normal;
        }

        .header-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            gap: 15px;
        }

        .filter-tabs {
            display: flex;
            gap: 10px;
        }

        .filter-tab {
            background: #ebebeb 0%;
            color: rgb(0, 0, 0);
            border: none;
            padding: 12px 28px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(11, 4, 4, 0.3);
        }

        .filter-tab.active {
            background: linear-gradient(135deg, #7d1414 0%, #5d0f0f 100%);
            color: white;
            border-color: #7d1414;
            box-shadow: 0 4px 12px rgba(125, 20, 20, 0.3);
        }

        .filter-tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(125, 20, 20, 0.4);
        }

        .filter-tab.active:hover {
            background-color: #5d0f0f;
        }

        .search-box {
            padding: 10px 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 200px;
            font-size: 14px;
        }

        .search-box:focus {
            outline: none;
            border-color: #7d1414;
        }

        .student-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
            max-height: 500px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .student-list::-webkit-scrollbar {
            width: 8px;
        }

        .student-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .student-list::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        .student-list::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        .student-item {
            background-color: #d4d4d4;
            padding: 18px 20px;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.3s;
            position: relative;
        }

        .student-item:hover {
            background-color: #c4c4c4;
        }

        .student-item.pending {
            border-left: 4px solid #ffc107;
        }

        .student-item.accepted {
            border-left: 4px solid #28a745;
        }

        .student-item.rejected {
            border-left: 4px solid #dc3545;
        }

        .student-info {
            flex: 1;
        }

        .student-name {
            font-size: 15px;
            color: #333;
            font-weight: 500;
        }

        .student-status {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }

        .status-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-badge.pending {
            background-color: #fff3cd;
            color: #856404;
        }

        .status-badge.accepted {
            background-color: #d4edda;
            color: #155724;
        }

        .status-badge.rejected {
            background-color: #f8d7da;
            color: #721c24;
        }

        .arrow {
            color: #666;
            font-size: 18px;
        }

        /* MODERN MODAL STYLES */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            padding: 0;
            border-radius: 24px;
            width: 900px;
            max-width: 95%;
            max-height: 90vh;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3),
                        0 0 0 1px rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            transform-origin: center;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            background: linear-gradient(135deg, rgba(154, 50, 50, 0.95) 0%, rgba(69, 11, 11, 0.95) 100%);
            padding: 32px 40px;
            border-radius: 24px 24px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .modal-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse"><path d="M 20 0 L 0 0 0 20" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            pointer-events: none;
        }

        .modal-title {
            font-size: 28px;
            color: white;
            font-weight: 600;
            letter-spacing: -0.5px;
            z-index: 1;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .status-indicator {
            padding: 10px 20px;
            border-radius: 50px;
            font-size: 13px;
            font-weight: 600;
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .modal-body {
            padding: 40px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
            overflow-y: auto;
            flex: 1;
            max-height: calc(90vh - 200px);
        }

        .modal-body::-webkit-scrollbar {
            width: 10px;
        }

        .modal-body::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
        }

        .modal-body::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #7d1414 0%, #5d0f0f 100%);
            border-radius: 10px;
        }

        .section-title {
            font-size: 18px;
            color: #2c3e50;
            font-weight: 700;
            margin-bottom: 8px;
            margin-top: 24px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e0e0e0;
            display: flex;
            align-items: center;
            gap: 10px;
            letter-spacing: -0.3px;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 24px;
            background: linear-gradient(180deg, #7d1414 0%, #5d0f0f 100%);
            border-radius: 2px;
        }

        .fieldset {
            border: 2px solid #e8e8e8;
            border-radius: 16px;
            padding: 24px;
            margin-top: 16px;
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .fieldset legend {
            font-size: 15px;
            color: #7d1414;
            padding: 0 12px;
            font-weight: 600;
            letter-spacing: 0.3px;
        }

        .form-group {
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: 120px 1fr auto;
            align-items: center;
            gap: 16px;
        }

        .form-group label {
            font-size: 14px;
            color: #495057;
            text-align: left;
            font-weight: 500;
            letter-spacing: 0.2px;
        }

        .form-group input,
        .form-group select {
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 14px;
            background: white;
            width: 100%;
            box-sizing: border-box;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.02);
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #7d1414;
            box-shadow: 0 0 0 4px rgba(125, 20, 20, 0.1);
            transform: translateY(-1px);
        }

        .form-group input:disabled,
        .form-group select:disabled {
            background-color: #f5f5f5;
            cursor: not-allowed;
        }

        .set-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #7d1414 0%, #5d0f0f 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 13px;
            cursor: pointer;
            white-space: nowrap;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(125, 20, 20, 0.3);
        }

        .set-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(125, 20, 20, 0.4);
        }

        .set-btn:active {
            transform: translateY(0);
        }

        .year-level-group {
            display: grid;
            grid-template-columns: 120px 1fr 20px;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
        }

        .year-level-group label {
            font-size: 14px;
            color: #495057;
            font-weight: 500;
        }

        .year-level-group input {
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 14px;
            width: 100%;
            box-sizing: border-box;
            background: white;
            transition: all 0.3s ease;
        }

        .form-group-full {
            grid-template-columns: 120px 1fr;
        }

        .modal-footer {
            padding: 28px 40px;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            border-top: 2px solid #e8e8e8;
            flex-shrink: 0;
            background: linear-gradient(180deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 0 0 24px 24px;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
        }

        .cancel-btn {
            padding: 14px 32px;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            font-size: 15px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .cancel-btn:hover {
            background: #f8f9fa;
            border-color: #adb5bd;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .accept-btn {
            padding: 14px 32px;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(40, 167, 69, 0.3);
        }

        .accept-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        .reject-btn {
            padding: 14px 32px;
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(220, 53, 69, 0.3);
        }

        .reject-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
        }

        .left-column {
            grid-column: 1;
        }

        .right-column {
            grid-column: 2;
        }

        .family-member {
            border: 2px solid #e8e8e8;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            background: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04);
            transition: all 0.3s ease;
        }

        .family-member:hover {
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
            transform: translateY(-2px);
        }

        .family-member-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid #f0f0f0;
        }

        .family-member-header strong {
            color: #2c3e50;
            font-size: 16px;
            letter-spacing: -0.2px;
        }

        .remove-family-btn {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 13px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(220, 53, 69, 0.2);
        }

        .remove-family-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
        }

        .add-family-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 12px;
            font-size: 15px;
            cursor: pointer;
            margin-top: 16px;
            width: 100%;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(40, 167, 69, 0.2);
        }

        .add-family-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.3);
        }

        .full-width {
            grid-column: 1 / -1;
        }

        #familyMembersContainer {
            max-height: none;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 10px;
            opacity: 0.3;
        }

        /* CONFIRMATION MODAL - MODERNIZED */
        .confirmation-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.65);
            backdrop-filter: blur(10px);
            justify-content: center;
            align-items: center;
            z-index: 2000;
            animation: fadeIn 0.3s ease;
        }

        .confirmation-modal.active {
            display: flex;
        }

        .confirmation-content {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 24px;
            width: 550px;
            max-width: 90%;
            box-shadow: 0 24px 64px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .confirmation-header {
            padding: 32px 36px;
            display: flex;
            align-items: center;
            gap: 20px;
            position: relative;
            overflow: hidden;
        }

        .confirmation-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse"><path d="M 20 0 L 0 0 0 20" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            pointer-events: none;
        }

        .confirmation-header.accept {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .confirmation-header.reject {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
        }

        .confirmation-icon {
            font-size: 36px;
            width: 64px;
            height: 64px;
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            z-index: 1;
        }

        .confirmation-header-text {
            z-index: 1;
        }

        .confirmation-header-text h3 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 6px;
            letter-spacing: -0.5px;
        }

        .confirmation-header-text p {
            font-size: 14px;
            opacity: 0.95;
            font-weight: 500;
        }

        .confirmation-body {
            padding: 36px;
        }

        .student-info-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            border-left: 4px solid #7d1414;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
        }

        .student-info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 14px;
            font-size: 15px;
        }

        .student-info-row:last-child {
            margin-bottom: 0;
        }

        .student-info-label {
            color: #6c757d;
            font-weight: 600;
        }

        .student-info-value {
            color: #2c3e50;
            font-weight: 700;
        }

        .confirmation-message {
            font-size: 15px;
            color: #495057;
            line-height: 1.7;
            margin-bottom: 24px;
        }

        .confirmation-message.accept {
            color: #155724;
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #28a745;
            box-shadow: 0 2px 8px rgba(40, 167, 69, 0.1);
        }

        .confirmation-message.reject {
            color: #721c24;
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #dc3545;
            box-shadow: 0 2px 8px rgba(220, 53, 69, 0.1);
        }

        .confirmation-footer {
            padding: 24px 36px;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            border-top: 2px solid #e8e8e8;
            background: linear-gradient(180deg, #ffffff 0%, #f8f9fa 100%);
        }

        .confirm-cancel-btn {
            padding: 12px 28px;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            font-size: 15px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .confirm-cancel-btn:hover {
            background: #f8f9fa;
            border-color: #adb5bd;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .confirm-action-btn {
            padding: 12px 28px;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s ease;
        }

        .confirm-action-btn.accept {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            box-shadow: 0 4px 16px rgba(40, 167, 69, 0.3);
        }

        .confirm-action-btn.accept:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        .confirm-action-btn.reject {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            box-shadow: 0 4px 16px rgba(220, 53, 69, 0.3);
        }

        .confirm-action-btn.reject:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
        }

        /* SUCCESS/ERROR TOAST NOTIFICATION */
        .toast-notification {
            position: fixed;
            top: 30px;
            right: 30px;
            min-width: 350px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.15);
            display: none;
            z-index: 3000;
            overflow: hidden;
            animation: slideInRight 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideOutRight {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(100px);
            }
        }

        .toast-notification.show {
            display: block;
        }

        .toast-notification.hide {
            animation: slideOutRight 0.3s ease-out forwards;
        }

        .toast-header {
            padding: 20px 24px;
            display: flex;
            align-items: center;
            gap: 16px;
            border-bottom: 2px solid #f0f0f0;
        }

        .toast-header.success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        }

        .toast-header.error {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
        }

        .toast-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            flex-shrink: 0;
        }

        .toast-icon.success {
            background: #28a745;
            color: white;
        }

        .toast-icon.error {
            background: #dc3545;
            color: white;
        }

        .toast-header-text {
            flex: 1;
        }

        .toast-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .toast-title.success {
            color: #155724;
        }

        .toast-title.error {
            color: #721c24;
        }

        .toast-subtitle {
            font-size: 13px;
            opacity: 0.8;
        }

        .toast-subtitle.success {
            color: #155724;
        }

        .toast-subtitle.error {
            color: #721c24;
        }

        .toast-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s;
            opacity: 0.6;
        }

        .toast-close:hover {
            opacity: 1;
            background: rgba(0, 0, 0, 0.05);
        }

        .toast-body {
            padding: 20px 24px;
        }

        .toast-message {
            font-size: 15px;
            line-height: 1.6;
            color: #495057;
        }

        .toast-progress {
            height: 4px;
            background: rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .toast-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #28a745 0%, #20c997 100%);
            width: 100%;
            animation: progressBar 3s linear forwards;
        }

        .toast-progress-bar.error {
            background: linear-gradient(90deg, #dc3545 0%, #c82333 100%);
        }

        @keyframes progressBar {
            from {
                width: 100%;
            }
            to {
                width: 0%;
            }
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .sidebar {
                width: 200px;
                padding: 15px 10px;
            }

            .menu-item {
                font-size: 14px;
                padding: 12px 8px;
            }

            .modal-content {
                width: 90%;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 180px;
                padding: 15px 8px;
            }

            .menu-item {
                font-size: 13px;
                padding: 10px 6px;
                gap: 8px;
            }

            .menu-icon {
                width: 18px;
                height: 18px;
                font-size: 12px;
            }

            .main-content {
                padding: 15px;
            }

            .content-wrapper {
                padding: 20px;
            }

            .header-section {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }

            .filter-tabs {
                flex-wrap: wrap;
            }

            .search-box {
                width: 100%;
            }

            .modal-content {
                width: 95%;
            }

            .modal-body {
                grid-template-columns: 1fr;
                padding: 20px;
                gap: 15px;
            }

            .left-column,
            .right-column {
                grid-column: 1;
            }

            .form-group {
                grid-template-columns: 90px 1fr auto;
                gap: 8px;
            }

            .year-level-group {
                grid-template-columns: 90px 1fr 20px;
            }

            .modal-footer {
                flex-direction: column;
                gap: 10px;
            }

            .action-buttons {
                flex-direction: column;
                width: 100%;
            }

            .cancel-btn,
            .accept-btn,
            .reject-btn {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .sidebar {
                width: 150px;
                padding: 10px 5px;
            }

            .menu-item span {
                font-size: 12px;
            }

            .form-group {
                grid-template-columns: 1fr;
                gap: 5px;
            }

            .form-group label {
                text-align: left;
            }

            .year-level-group {
                grid-template-columns: 1fr;
            }

            .year-level-group span {
                display: none;
            }

            .set-btn {
                width: 100%;
            }

            .student-item {
                padding: 15px;
            }

            .page-title {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <img class="image" src="euC (1).png" alt="Logo" style="width: 50%; margin-bottom: 20px; align-self: center;">
        <a href="dashboard.html" class="menu-item">
            <div class="menu-icon">◷</div>
            <span>Dashboard</span>
        </a>
        <a href="registration.html" class="menu-item active">
            <div class="menu-icon">◷</div>
            <span>Registration</span>
        </a>
        <a href="sp.html" class="menu-item">
            <div class="menu-icon">◷</div>
            <span>Student Profile</span>
        </a>
        <a href="section.html" class="menu-item">
            <div class="menu-icon">◷</div>
            <span>Section List</span>
        </a>
    </div>

    <div class="main-content">
        <h1 class="page-title">Registration</h1>
        <div class="content-wrapper">
            <div class="header-section">
                <div class="filter-tabs">
                    <div class="filter-tab active" data-status="all" onclick="filterByStatus('all')">All</div>
                    <div class="filter-tab" data-status="pending" onclick="filterByStatus('pending')">Pending</div>
                    <div class="filter-tab" data-status="accepted" onclick="filterByStatus('accepted')">Accepted</div>
                    <div class="filter-tab" data-status="rejected" onclick="filterByStatus('rejected')">Rejected</div>
                </div>
                <input type="text" class="search-box" placeholder="Search" id="searchBox" oninput="filterStudents()">
            </div>

            <div class="student-list" id="studentList"></div>
        </div>
    </div>

    <div class="modal" id="addStudentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Student Profile</h2>
                <div class="status-indicator" id="statusIndicator"></div>
            </div>
            <form onsubmit="return false;" id="studentForm">
                <div class="modal-body">
                    <!-- Left Column -->
                    <div class="left-column">
                        <div class="form-group">
                            <label>Student No.</label>
                            <input type="text" id="studentNo" required>
                            <button type="button" class="set-btn">Set</button>
                        </div>
                        
                        <div class="form-group form-group-full">
                            <label>Last Name</label>
                            <input type="text" id="lastName" required>
                        </div>
                        
                        <div class="form-group form-group-full">
                            <label>First Name</label>
                            <input type="text" id="firstName" required>
                        </div>
                        
                        <div class="form-group form-group-full">
                            <label>Middle Name</label>
                            <input type="text" id="middleName">
                        </div>
                        
                        <div class="form-group form-group-full">
                            <label>Ext. Name</label>
                            <input type="text" id="extName">
                        </div>
                        
                        <div class="section-title">Profile</div>
                        
                        <div class="form-group form-group-full">
                            <label>Program</label>
                            <select id="program">
                                <option value="Elementary">Elementary</option>
                                <option value="High School">High School</option>
                                <option value="College">College</option>
                            </select>
                        </div>
                        
                        <div class="form-group form-group-full">
                            <label>Curriculum Code</label>
                            <input type="text" id="curriculumCode">
                        </div>
                        
                        <div class="form-group form-group-full">
                            <label>Date Graduated</label>
                            <input type="date" id="dateGraduated">
                        </div>
                        
                        <div class="form-group form-group-full">
                            <label>LRN</label>
                            <input type="text" id="LRN">
                        </div>
                        
                        <div class="form-group form-group-full">
                            <label>Citizenship</label>
                            <input type="text" id="citizenship">
                        </div>
                        
                        <div class="form-group form-group-full">
                            <label>Religion</label>
                            <input type="text" id="religion">
                        </div>
                        
                        <div class="section-title">Contacts/Address</div>

                        <div class="form-group form-group-full">
                            <label>Email</label>
                            <input type="email" id="email">
                        </div>

                        <div class="form-group form-group-full">
                            <label>Phone</label>
                            <input type="text" id="phone">
                        </div>

                        <div class="form-group form-group-full">
                            <label>Street</label>
                            <input type="text" id="street">
                        </div>

                        <div class="form-group form-group-full">
                            <label>Barangay</label>
                            <input type="text" id="brgy">
                        </div>

                        <div class="form-group form-group-full">
                            <label>City/Town</label>
                            <input type="text" id="city">
                        </div>

                        <div class="form-group form-group-full">
                            <label>Province</label>
                            <input type="text" id="province">
                        </div>
                    </div>

                    <!-- Right Column -->
                    <div class="right-column">
                        <div class="year-level-group">
                            <label>Year Level</label>
                            <input type="text" id="yearLevel">
                            <span style="font-size: 20px; color: #666;">›</span>
                        </div>
                        
                        <fieldset class="fieldset">
                            <legend>Admission</legend>
                            
                            <div class="form-group form-group-full">
                                <label>Date</label>
                                <input type="date" id="admissionDate">
                            </div>
                            
                            <div class="form-group form-group-full">
                                <label>School Year</label>
                                <input type="text" id="schoolYear">
                            </div>
                            
                            <div class="form-group form-group-full">
                                <label>Period</label>
                                <input type="text" id="period">
                            </div>
                        </fieldset>
                        
                        <div style="margin-top: 25px;">
                            <div class="form-group form-group-full">
                                <label>Gender</label>
                                <select id="gender">
                                    <option value="">Select Gender</option>
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                </select>
                            </div>
                            
                            <div class="form-group form-group-full">
                                <label>Age</label>
                                <select id="age">
                                    <option value="">Select Age</option>
                                    <option value="5">5</option>
                                    <option value="6">6</option>
                                    <option value="7">7</option>
                                    <option value="8">8</option>
                                    <option value="9">9</option>
                                    <option value="10">10</option>
                                    <option value="11">11</option>
                                    <option value="12">12</option>
                                    <option value="13">13</option>
                                    <option value="14">14</option>
                                    <option value="15">15</option>
                                    <option value="16">16</option>
                                    <option value="17">17</option>
                                    <option value="18">18</option>
                                </select>
                            </div>
                            
                            <div class="form-group form-group-full">
                                <label>Section</label>
                                <input type="text" id="section">
                            </div>
                        </div>
                    </div>

                    <!-- Family Section - Full Width -->
                    <div class="full-width">
                        <div class="section-title">Family Information</div>
                        <div id="familyMembersContainer"></div>
                        <button type="button" class="add-family-btn" onclick="addFamilyMember()">+ Add Family Member</button>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <div class="action-buttons" id="reviewActions" style="display: none;">
                        <button type="button" class="cancel-btn" onclick="closeModal()">Cancel</button>
                        <button type="button" class="reject-btn" onclick="showConfirmationModal('rejected')">Reject</button>
                        <button type="button" class="accept-btn" onclick="showConfirmationModal('accepted')">Accept</button>
                    </div>
                    <div class="action-buttons" id="viewOnlyActions" style="display: none;">
                        <button type="button" class="cancel-btn" onclick="closeModal()">Close</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="confirmation-modal" id="confirmationModal">
        <div class="confirmation-content">
            <div class="confirmation-header" id="confirmHeader">
                <div class="confirmation-icon" id="confirmIcon"></div>
                <div class="confirmation-header-text">
                    <h3 id="confirmTitle"></h3>
                    <p id="confirmSubtitle"></p>
                </div>
            </div>
            <div class="confirmation-body">
                <div class="student-info-card">
                    <div class="student-info-row">
                        <span class="student-info-label">Applicant Name:</span>
                        <span class="student-info-value" id="confirmStudentName"></span>
                    </div>
                    <div class="student-info-row">
                        <span class="student-info-label">Student Number:</span>
                        <span class="student-info-value" id="confirmStudentNo"></span>
                    </div>
                    <div class="student-info-row">
                        <span class="student-info-label">Program:</span>
                        <span class="student-info-value" id="confirmProgram"></span>
                    </div>
                </div>
                <div class="confirmation-message" id="confirmMessage"></div>
            </div>
            <div class="confirmation-footer">
                <button type="button" class="confirm-cancel-btn" onclick="closeConfirmationModal()">Cancel</button>
                <button type="button" class="confirm-action-btn" id="confirmActionBtn" onclick="confirmApplicationStatus()"></button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast-notification" id="toastNotification">
        <div class="toast-header" id="toastHeader">
            <div class="toast-icon" id="toastIcon"></div>
            <div class="toast-header-text">
                <div class="toast-title" id="toastTitle"></div>
                <div class="toast-subtitle" id="toastSubtitle"></div>
            </div>
            <button class="toast-close" onclick="hideToast()">×</button>
        </div>
        <div class="toast-body">
            <div class="toast-message" id="toastMessage"></div>
        </div>
        <div class="toast-progress">
            <div class="toast-progress-bar" id="toastProgressBar"></div>
        </div>
    </div>

    <script>
let currentStudentId = null;
let currentStudentStatus = null;
let familyMemberCount = 0;
let currentFilter = 'all';
let pendingStatusAction = null;
let toastTimeout = null;

function showToast(type, title, subtitle, message) {
    console.log("=== SHOW TOAST CALLED ===");
    console.log("Type:", type);
    console.log("Title:", title);
    console.log("Subtitle:", subtitle);
    console.log("Message:", message);
    
    const toast = document.getElementById('toastNotification');
    const toastHeader = document.getElementById('toastHeader');
    const toastIcon = document.getElementById('toastIcon');
    const toastTitle = document.getElementById('toastTitle');
    const toastSubtitle = document.getElementById('toastSubtitle');
    const toastMessage = document.getElementById('toastMessage');
    const toastProgressBar = document.getElementById('toastProgressBar');

    console.log("Toast element:", toast);
    console.log("Toast header:", toastHeader);
    
    if (!toast) {
        console.error("❌ TOAST ELEMENT NOT FOUND!");
        alert("Toast element not found in the HTML!");
        return;
    }

    // Clear any existing timeout
    if (toastTimeout) {
        clearTimeout(toastTimeout);
    }

    // Reset classes
    toastHeader.className = `toast-header ${type}`;
    toastIcon.className = `toast-icon ${type}`;
    toastTitle.className = `toast-title ${type}`;
    toastSubtitle.className = `toast-subtitle ${type}`;
    toastProgressBar.className = `toast-progress-bar ${type}`;

    // Set content
    toastIcon.textContent = type === 'success' ? '✓' : '✗';
    toastTitle.textContent = title;
    toastSubtitle.textContent = subtitle;
    toastMessage.textContent = message;

    // Show toast with explicit display style
    toast.style.display = 'block';
    toast.classList.remove('hide');
    toast.classList.add('show');
    
    console.log("✅ Toast should now be visible!");
    console.log("Toast classes:", toast.className);
    console.log("Toast display:", toast.style.display);

    // Reset progress bar animation
    toastProgressBar.style.animation = 'none';
    setTimeout(() => {
        toastProgressBar.style.animation = 'progressBar 3s linear forwards';
    }, 10);

    // Auto hide after 3 seconds
    toastTimeout = setTimeout(() => {
        console.log("Auto-hiding toast...");
        hideToast();
    }, 3000);
}

function hideToast() {
    const toast = document.getElementById('toastNotification');
    toast.classList.add('hide');
    
    setTimeout(() => {
        toast.classList.remove('show');
    }, 300);
}

function showConfirmationModal(action) {
    console.log("=== showConfirmationModal called with action:", action);
    
    pendingStatusAction = action;
    const modal = document.getElementById('confirmationModal');
    const header = document.getElementById('confirmHeader');
    const icon = document.getElementById('confirmIcon');
    const title = document.getElementById('confirmTitle');
    const subtitle = document.getElementById('confirmSubtitle');
    const message = document.getElementById('confirmMessage');
    const footer = document.querySelector('.confirmation-footer');
    
    if (!header || !icon || !title || !subtitle || !message || !footer) {
        console.error("ERROR: Essential modal elements are missing!");
        alert("Error: Modal elements not found. Please refresh the page.");
        return;
    }
    
    const studentName = `${document.getElementById('firstName').value} ${document.getElementById('middleName').value} ${document.getElementById('lastName').value}`.trim();
    const studentNo = document.getElementById('studentNo').value;
    const program = document.getElementById('program').value;
    
    document.getElementById('confirmStudentName').textContent = studentName;
    document.getElementById('confirmStudentNo').textContent = studentNo || 'N/A';
    document.getElementById('confirmProgram').textContent = program;
    
    if (action === 'accepted') {
        header.className = 'confirmation-header accept';
        icon.textContent = '✓';
        title.textContent = 'Accept Application';
        subtitle.textContent = 'Approve this student for enrollment';
        message.className = 'confirmation-message accept';
        message.textContent = '✓ By accepting this application, the student will be enrolled in the system and can proceed with their registration. This action confirms that all requirements have been met.';
        
        footer.innerHTML = `
            <button type="button" class="confirm-cancel-btn" onclick="closeConfirmationModal()">Cancel</button>
            <button type="button" class="confirm-action-btn accept" onclick="confirmApplicationStatus()">Confirm Accept</button>
        `;
    } else {
        header.className = 'confirmation-header reject';
        icon.textContent = '✗';
        title.textContent = 'Reject Application';
        subtitle.textContent = 'Decline this student application';
        message.className = 'confirmation-message reject';
        message.textContent = '✗ By rejecting this application, the student will not be enrolled. This action indicates that the requirements were not met or the application contains issues. The applicant will be notified of this decision.';
        
        footer.innerHTML = `
            <button type="button" class="confirm-cancel-btn" onclick="closeConfirmationModal()">Cancel</button>
            <button type="button" class="confirm-action-btn reject" onclick="confirmApplicationStatus()">Confirm Reject</button>
        `;
    }
    
    modal.classList.add('active');
}

async function confirmApplicationStatus() {
    console.log("=== confirmApplicationStatus called ===");
    console.log("Current Student ID:", currentStudentId);
    console.log("Pending Action:", pendingStatusAction);
    
    if (!currentStudentId || !pendingStatusAction) {
        console.error("Missing student ID or action!");
        return;
    }

    try {
        const response = await fetch(`http://localhost:5001/api/admissions/${currentStudentId}/status`, {
            method: "PATCH",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ status: pendingStatusAction })
        });

        if (response.ok) {
            const result = await response.json();
            console.log("Server response:", result);
            closeConfirmationModal();
            closeModal();

            // console.log(pendingStatusAction);
            // const myStatus = result?.message
            // let test= myStatus.slice(12, 20)
            // console.log(test);

            const myStatus = result?.message;
            let test = myStatus.includes('accepted') ? 'accepted' : 'rejected'

            // Show success toast based on the action
            const studentName = `${document.getElementById('firstName').value} ${document.getElementById('lastName').value}`.trim();
            
            if (test == 'accepted') {
                // ✅ ACCEPTED - Show SUCCESS toast (green)
                console.log(`show toast accept`);
                showToast(
                    'success',
                    'Application Accepted!',
                    'Student enrolled successfully',
                    `${studentName} has been successfully accepted and enrolled in the system.`
                );

                test = null
            } else if (test == 'rejected') {
                // ❌ REJECTED - Show ERROR toast (red)
                console.log(`show toast reject`);
                showToast(
                    'error',
                    'Application Rejected',
                    'Student application declined',
                    `${studentName}'s application has been rejected and moved to archive.`
                );

                test = null
            }
            
            await loadStudents();
        } else {
            const error = await response.json();
            console.error("Server error:", error);
            showToast(
                'error',
                'Error',
                'Failed to update status',
                `Could not update application status: ${error.error || 'Unknown error'}`
            );
        }
    } catch (err) {
        console.error("Error updating status:", err);
        showToast(
            'error',
            'Connection Error',
            'Could not connect to server',
            'Please check your internet connection and try again.'
        );
    }
}

function addFamilyMember(memberData = null) {
    familyMemberCount++;
    const memberId = memberData ? memberData.id : `family-${familyMemberCount}`;
    
    const container = document.getElementById('familyMembersContainer');
    const memberDiv = document.createElement('div');
    memberDiv.className = 'family-member';
    memberDiv.id = memberId;
    
    memberDiv.innerHTML = `
        <div class="family-member-header">
            <strong>Family Member ${familyMemberCount}</strong>
            <button type="button" class="remove-family-btn" onclick="removeFamilyMember('${memberId}')">Remove</button>
        </div>
        
        <div class="form-group form-group-full">
            <label>Relation</label>
            <select class="family-relation" required>
                <option value="">Select Relation</option>
                <option value="Mother" ${memberData && memberData.relation === 'Mother' ? 'selected' : ''}>Mother</option>
                <option value="Father" ${memberData && memberData.relation === 'Father' ? 'selected' : ''}>Father</option>
                <option value="Guardian" ${memberData && memberData.relation === 'Guardian' ? 'selected' : ''}>Guardian</option>
            </select>
        </div>
        
        <div class="form-group form-group-full">
            <label>Full Name</label>
            <input type="text" class="family-name" value="${memberData ? memberData.name : ''}" required>
        </div>
        
        <div class="form-group form-group-full">
            <label>Occupation</label>
            <input type="text" class="family-occupation" value="${memberData ? memberData.occupation : ''}">
        </div>
        
        <div class="form-group form-group-full">
            <label>Contact No.</label>
            <input type="text" class="family-contact" value="${memberData ? memberData.contact : ''}">
        </div>
        
        <div class="form-group form-group-full">
            <label>Address</label>
            <input type="text" class="family-address" value="${memberData ? memberData.address : ''}">
        </div>
    `;
    
    container.appendChild(memberDiv);
}

function removeFamilyMember(memberId) {
    const member = document.getElementById(memberId);
    if (member) {
        member.remove();
    }
}

function updateStatusIndicator(status) {
    const indicator = document.getElementById('statusIndicator');
    const reviewActions = document.getElementById('reviewActions');
    const viewOnlyActions = document.getElementById('viewOnlyActions');
    
    const formInputs = document.querySelectorAll('#studentForm input, #studentForm select');
    formInputs.forEach(input => {
        input.setAttribute('readonly', true);
        input.style.pointerEvents = 'none';
    });
    
    document.querySelectorAll('.remove-family-btn, .add-family-btn, .set-btn').forEach(btn => {
        btn.style.display = 'none';
    });
    
    if (status === 'pending') {
        indicator.className = 'status-indicator status-badge pending';
        indicator.textContent = 'Pending Review';
        reviewActions.style.display = 'flex';
        viewOnlyActions.style.display = 'none';
    } else if (status === 'accepted') {
        indicator.className = 'status-indicator status-badge accepted';
        indicator.textContent = 'Accepted';
        reviewActions.style.display = 'none';
        viewOnlyActions.style.display = 'flex';
    } else if (status === 'rejected') {
        indicator.className = 'status-indicator status-badge rejected';
        indicator.textContent = 'Rejected';
        reviewActions.style.display = 'none';
        viewOnlyActions.style.display = 'flex';
    } else {
        indicator.className = '';
        indicator.textContent = '';
        reviewActions.style.display = 'none';
        viewOnlyActions.style.display = 'none';
    }
}

function openModal(studentData = null) {
    const modal = document.getElementById('addStudentModal');
    const modalTitle = document.querySelector('.modal-title');
    
    document.getElementById('familyMembersContainer').innerHTML = '';
    familyMemberCount = 0;
    
    if (studentData) {
        currentStudentId = studentData.id;
        currentStudentStatus = studentData.status || 'pending';
        modalTitle.textContent = 'Student Application';
        
        updateStatusIndicator(currentStudentStatus);
        
        document.getElementById('studentNo').value = studentData.student_no || '';
        document.getElementById('firstName').value = studentData.first_name || '';
        document.getElementById('middleName').value = studentData.middle_name || '';
        document.getElementById('lastName').value = studentData.last_name || '';
        document.getElementById('extName').value = studentData.ext_name || '';
        document.getElementById('program').value = studentData.program || '';
        document.getElementById('curriculumCode').value = studentData.curriculum_code || '';
        document.getElementById('dateGraduated').value = studentData.date_graduated || '';
        document.getElementById('LRN').value = studentData.lrn || '';
        document.getElementById('citizenship').value = studentData.citizenship || '';
        document.getElementById('religion').value = studentData.religion || '';
        document.getElementById('email').value = studentData.email || '';
        document.getElementById('phone').value = studentData.phone || '';
        document.getElementById('street').value = studentData.street || '';
        document.getElementById('brgy').value = studentData.barangay || '';
        document.getElementById('city').value = studentData.city || '';
        document.getElementById('province').value = studentData.province || '';
        document.getElementById('yearLevel').value = studentData.year_level || '';
        document.getElementById('admissionDate').value = studentData.admission_date || '';
        document.getElementById('schoolYear').value = studentData.school_year || '';
        document.getElementById('period').value = studentData.period || '';
        document.getElementById('gender').value = studentData.gender || '';
        document.getElementById('age').value = studentData.age || '';
        document.getElementById('section').value = studentData.section || '';
        
        if (studentData.family_members && studentData.family_members.length > 0) {
            studentData.family_members.forEach(member => {
                addFamilyMember(member);
            });
        }
    } else {
        currentStudentId = null;
        currentStudentStatus = null;
        modalTitle.textContent = 'New Student';
        updateStatusIndicator(null);
        document.querySelector('form').reset();
    }
    
    modal.classList.add('active');
}

function closeModal() {
    document.getElementById('addStudentModal').classList.remove('active');
    document.querySelector('form').reset();
    document.getElementById('familyMembersContainer').innerHTML = '';
    familyMemberCount = 0;
    currentStudentId = null;
    currentStudentStatus = null;
}

function closeConfirmationModal() {
    const modal = document.getElementById('confirmationModal');
    modal.classList.remove('active');
    pendingStatusAction = null;
}

async function loadStudents() {
    try {
        // Use the new endpoint that fetches from all tables
        const response = await fetch("http://localhost:5001/api/admissions/all");
        const students = await response.json();

        const studentList = document.getElementById("studentList");
        studentList.innerHTML = "";

        const filteredStudents = currentFilter === 'all' 
            ? students 
            : students.filter(s => s.status === currentFilter);

        if (filteredStudents.length === 0) {
            studentList.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">📋</div>
                    <p>No ${currentFilter === 'all' ? '' : currentFilter} applications found</p>
                </div>
            `;
            return;
        }

        filteredStudents.forEach(student => {
            const status = student.status;
            const fullName = `${student.first_name} ${student.middle_name ? student.middle_name + " " : ""}${student.last_name}`;
            
            const studentItem = document.createElement("div");
            studentItem.className = `student-item ${status}`;
            // Pass both status and id to viewStudent
            studentItem.onclick = () => viewStudent(student.status, student.id);
            studentItem.innerHTML = `
                <div class="student-info">
                    <div class="student-name">${fullName}</div>
                    <div class="student-status">
                        <span class="status-badge ${status}">${status}</span>
                    </div>
                </div>
                <span class="arrow">›</span>
            `;
            studentList.appendChild(studentItem);
        });
    } catch (err) {
        console.error("Error loading students:", err);
        const studentList = document.getElementById("studentList");
        studentList.innerHTML = `
            <div class="empty-state">
                <div class="empty-state-icon">⚠️</div>
                <p>Error loading applications. Please try again.</p>
            </div>
        `;
    }
}

async function viewStudent(status, id) {
    try {
        // Use the new endpoint that fetches from the correct table based on status
        const response = await fetch(`http://localhost:5001/api/registrations/${status}/${id}`);
        if (response.ok) {
            const studentData = await response.json();
            
            if (currentFilter === 'pending' && studentData.status === 'pending') {
                currentStudentId = studentData.id;
                currentStudentStatus = studentData.status;
                
                document.getElementById('studentNo').value = studentData.student_no || '';
                document.getElementById('firstName').value = studentData.first_name || '';
                document.getElementById('middleName').value = studentData.middle_name || '';
                document.getElementById('lastName').value = studentData.last_name || '';
                document.getElementById('program').value = studentData.program || '';
                
                showDecisionPrompt(studentData);
            } else {
                openModal(studentData);
            }
        } else {
            showToast('error', 'Error', 'Failed to load student', 'Could not retrieve student details from server.');
        }
    } catch (err) {
        console.error("Error fetching student:", err);
        showToast('error', 'Connection Error', 'Could not connect to server', 'Please check your internet connection and try again.');
    }
}

function showDecisionPrompt(studentData) {
    const modal = document.getElementById('confirmationModal');
    const header = document.getElementById('confirmHeader');
    const icon = document.getElementById('confirmIcon');
    const title = document.getElementById('confirmTitle');
    const subtitle = document.getElementById('confirmSubtitle');
    const message = document.getElementById('confirmMessage');
    const footer = document.querySelector('.confirmation-footer');
    
    const fullName = `${studentData.first_name} ${studentData.middle_name ? studentData.middle_name + ' ' : ''}${studentData.last_name}`;
    const studentNo = studentData.student_no || 'N/A';
    const program = studentData.program || 'N/A';
    
    document.getElementById('confirmStudentName').textContent = fullName;
    document.getElementById('confirmStudentNo').textContent = studentNo;
    document.getElementById('confirmProgram').textContent = program;
    
    header.className = 'confirmation-header';
    header.style.background = 'linear-gradient(135deg, rgb(154, 50, 50) 0%, rgb(69, 11, 11) 100%)';
    header.style.color = 'white';
    icon.textContent = '📋';
    title.textContent = 'Review Application';
    subtitle.textContent = 'Make a decision on this application';
    message.className = 'confirmation-message';
    message.style.background = '#f8f9fa';
    message.style.color = '#333';
    message.style.border = 'none';
    message.innerHTML = `
        <strong>Application Review</strong><br><br>
        Please review this application and decide whether to accept or reject the applicant. 
        You can also view the full details before making a decision.
    `;
    
    footer.innerHTML = `
        <button type="button" class="confirm-cancel-btn" onclick="closeConfirmationModal()">Close</button>
        <button type="button" class="confirm-cancel-btn" onclick="viewFullDetails()">View Full Details</button>
        <button type="button" class="confirm-action-btn reject" onclick="showConfirmationModal('rejected')">Reject</button>
        <button type="button" class="confirm-action-btn accept" onclick="showConfirmationModal('accepted')">Accept</button>
    `;
    
    modal.classList.add('active');
}

function viewFullDetails() {
    closeConfirmationModal();
    if (currentStudentId && currentStudentStatus) {
        fetch(`http://localhost:5001/api/registrations/${currentStudentStatus}/${currentStudentId}`)
            .then(response => response.json())
            .then(studentData => {
                openModal(studentData);
            })
            .catch(err => {
                console.error("Error fetching student:", err);
                showToast('error', 'Error', 'Failed to load details', 'Could not load student details from server.');
            });
    }
}

function filterByStatus(status) {
    currentFilter = status;
    
    document.querySelectorAll('.filter-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    document.querySelector(`[data-status="${status}"]`).classList.add('active');
    
    loadStudents();
}

function filterStudents() {
    const searchTerm = document.getElementById('searchBox').value.toLowerCase();
    const students = document.querySelectorAll('.student-item');
    
    students.forEach(student => {
        const name = student.querySelector('.student-name').textContent.toLowerCase();
        if (name.includes(searchTerm)) {
            student.style.display = 'flex';
        } else {
            student.style.display = 'none';
        }
    });
}

// Event Listeners
document.addEventListener("DOMContentLoaded", loadStudents);

document.getElementById('confirmationModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeConfirmationModal();
    }
});

document.getElementById('addStudentModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeModal();
    }
});
    </script>
</body>
</html>